name: kthcloud-ci

on:
    workflow_dispatch:

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Login to Cloud Registry
              uses: docker/login-action@v3
              with:
                registry: registry.cloud.cbh.kth.se
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_PASSWORD }}

            - name: Pull latest PostgreSQL image
              run: docker pull postgres:latest

            - name: Tag PostgreSQL image for cloud deployment
              run: docker tag postgres:latest ${{ secrets.DOCKER_TAG_POSTGRES }}

            - name: Push image to cloud registry
              run: docker push ${{ secrets.DOCKER_TAG_POSTGRES }}
